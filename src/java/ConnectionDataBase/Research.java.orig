package ConnectionDataBase;
// Generated 06-Jun-2011 22:44:46 by Hibernate Tools 3.2.1.GA

import Connections.ConnectionSingleton;
<<<<<<< HEAD
import utilities.LecturersManager;
=======
import java.io.IOException;
>>>>>>> master
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import javax.faces.context.FacesContext;
import javax.servlet.http.HttpSession;
<<<<<<< HEAD
import utilities.Lecturer;


public class Research implements java.io.Serializable, Runnable {


    /* ------------------------------  GUI --------------------- */
     private ResearchId id;
     private Integer researchpoints;
     private List<Research> researchList;
     private List<Research> finishedResearch;

     private int researchTime;
     private int researchBoost;

     /* -------------------------  Backend --------------------- */
     ArrayList<Lecturer> researchers;



    public Research() {
        id = new ResearchId();
        researchers = new ArrayList<Lecturer>();
=======

public class Research implements java.io.Serializable, Runnable  {

    private ResearchId id;
    private Integer researchpoints;
    private List<Research> researchList;
    private List<Research> finishedResearch;
    private List lecturers;
    private int researchTime;
    private int researchBoost;
    private final static String RUNNING = "Running";
    private final static String FINISHED = "Finished";
    private final static String STOPPED = "Stopped";
    private String state;

    public Research() {
        id = new ResearchId();
        lecturers = new ArrayList();
        state = STOPPED;
>>>>>>> master
    }

    public Research(ResearchId id) {
        researchBoost = 1;
        researchTime = 10;
        this.id = id;
<<<<<<< HEAD
        researchers = new ArrayList<Lecturer>();
=======
        lecturers = new ArrayList();
        state = STOPPED;
>>>>>>> master
    }

    public Research(ResearchId id, Integer researchpoints) {
<<<<<<< HEAD
       this.id = id;
       this.researchpoints = researchpoints;
       researchers = new ArrayList<Lecturer>();
    }


    public void addResearcher(Lecturer lec) {
        researchers.add(lec);
=======
        this.id = id;
        this.researchpoints = researchpoints;
        lecturers = new ArrayList();
        state = STOPPED;
>>>>>>> master
    }

    public ResearchId getId() {
        return this.id;
    }

    public void setId(ResearchId id) {
        this.id = id;
    }

    public Integer getResearchpoints() {
        return this.researchpoints;
    }

    public void setResearchpoints(Integer researchpoints) {
        this.researchpoints = researchpoints;
    }

    public void setResearchBoost(int boost) {
        this.researchBoost = boost;
    }

    public int getResearchBoost() {
        return this.researchBoost;
    }

<<<<<<< HEAD
=======
    public void addLecturer(String lecturer) {
        lecturers.add(lecturer);
    }

    public void removeLecturer(String lecturer) {
        lecturers.remove(lecturer);
    }

    public List getLecturers() {
        return lecturers;
    }
>>>>>>> master

    public String getName() {
        return id.getTitle();
    }

    public void setName(String name) {
        id.setTitle(name);
    }

    public String getUserId() {
        return id.getIdname();
    }

    public void setUserId(String userid) {
        id.setIdname(userid);
    }

    public String getState() {
        return state;
    }

    private void addPointsToUser() throws SQLException {

        PlayerresourcesHelper playerResourcesHelper = new PlayerresourcesHelper();
        playerResourcesHelper.addResearchPoints(getUserId(), getResearchpoints());

    }

    public void run() {
        state = RUNNING;

        try {
            researchTime = 10;

<<<<<<< HEAD
            int sleep_time = 20000;

            if (this.researchBoost != 0) {
                sleep_time = sleep_time/this.researchBoost;
            }

            while(researchTime > 0) {
                Thread.sleep(sleep_time);
=======
            while (researchTime > 0) {

                while(state == STOPPED) Thread.sleep(1000);

                Thread.sleep(1000);
>>>>>>> master
                researchTime--;
            }

            addPointsToUser();

        } catch (Exception ex) {
        } finally {
            researchList.remove(this);
            finishedResearch.add(this);

            /* Making all participating lecturer usable again.*/
            LecturersHelper helper
                    = new LecturersHelper();

            Iterator<Lecturer> it = researchers.iterator();
            while (it.hasNext()) {
                Lecturer lec = it.next();
                helper.setUsable(lec.getName(), true);
            }


        }
    }

    public String getResearchTime() {
        return researchTime + "";
    }

    public void addResearchList(List<Research> ongoingResearch) {
        researchList = ongoingResearch;
    }

    public void addFinishedResearchList(List<Research> finishedResearch) {
        this.finishedResearch = finishedResearch;
    }

    public String manageResearch() throws IOException {
        FacesContext facesContext = FacesContext.getCurrentInstance();
        HttpSession session = (HttpSession) facesContext.getExternalContext().getSession(true);

        System.out.println("Setting up research...");

        session.setAttribute(ConnectionSingleton.researchName, getName());

        return "go";
    }

    public void changeState() {
        if(state == RUNNING) {
            state = STOPPED;
        }
        else  {
            state = RUNNING;
        }
    }

}
